{% extends 'base.html' %}
{% load static %}

{% block content %}
  <h2>{{ idea.name }}</h2>
  
  <!-- ì°œí•˜ê¸° ë²„íŠ¼ ì¶”ê°€ -->

  <img src="{{ idea.image.url }}" alt="{{ idea.name }} ì´ë¯¸ì§€">
  <br>
  <button id="star-btn" data-idea-id="{{ idea.pk }}" class="btn {% if idea.starred %}btn-warning{% else %}btn-outline-warning{% endif %}">
    {% if idea.starred %}
      ğŸŒ ì°œë¨
    {% else %}
      ğŸŒ‘ ì°œí•˜ê¸°
    {% endif %}
  </button>
  <p>ë‚´ìš©: {{ idea.description }}</p>
  <p>ì•„ì´ë””ì–´ ê´€ì‹¬ë„: {{ idea.interest }}</p>
  <p>ë“±ë¡ì¼: {{ idea.created_at }}</p>
  <p>ìˆ˜ì •ì¼: {{ idea.updated_at }}</p>
  
  {% if idea.devtool %}
    <p>ì˜ˆìƒ ê°œë°œíˆ´: 
      <a href="{% url 'devtools:devtool_detail' idea.devtool.pk %}">
        {{ idea.get_expected_tools_display }}
      </a>
    </p>
  {% else %}
    <p>ì˜ˆìƒ ê°œë°œíˆ´: {{ idea.get_expected_tools_display }}</p>
  {% endif %}

  <a href="{% url 'ideas:idea_update' idea.pk %}" class="btn btn-secondary mt-3">ìˆ˜ì •í•˜ê¸°</a>
  <form action="{% url 'ideas:idea_delete' idea.pk %}" method="post" style="display: inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">ì‚­ì œí•˜ê¸°</button>
  </form>
  <a href="{% url 'ideas:idea_list' %}" class="btn btn-secondary mt-3">ëª©ë¡ìœ¼ë¡œ</a>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const starBtn = document.getElementById('star-btn');
      starBtn.addEventListener('click', function() {
        const ideaId = this.dataset.ideaId;
        const isStarred = this.textContent.trim().startsWith('ğŸŒ');

        fetch(`/ideas/${ideaId}/toggle-star/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
          },
          body: JSON.stringify({ starred: !isStarred })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            if (data.starred) {
              this.textContent = 'ğŸŒ ì°œë¨';
              this.classList.remove('btn-outline-warning');
              this.classList.add('btn-warning');
            } else {
              this.textContent = 'ğŸŒ‘ ì°œí•˜ê¸°';
              this.classList.remove('btn-warning');
              this.classList.add('btn-outline-warning');
            }
          }
        })
        .catch(error => console.error('Error:', error));
      });
    });
  </script>
{% endblock %}